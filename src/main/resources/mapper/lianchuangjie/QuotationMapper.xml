<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lianchuangjie.lianchuangjie.mapper.QuotationMapper">
    <select id="selectList" resultType="com.lianchuangjie.lianchuangjie.vo.QuotationVO">
        SELECT
        U_ICIN1.*,
        U_ICIN1.PrePrice AS 'U_PrePrice',
        T_ICIN.InquiryDate,
        T_ICIN.U_DomainName,
        T_ICIN.U_CusIndustries AS 'U_Industries',
        T_ICIN.U_CusLevel,
        T_ICIN.U_CusGroupCode,
        T_ICIN.U_DeptName,
        T_ICIN.U_UserName,
        T_ICIN.U_VatGroup,
        T_ICIN.U_ShortCode,
        fp.UnableQuote,
        /*无法报价*/
        fp.U_BaseLine,
        /*对应询价单内部编号*/
        fp.U_BaseEntry,
        /*对应询价单主表编号*/
        fp.U_Status,
        /*报价状态*/
        fp.U_QuoBrand,
        /*采购报价品牌*/
        fp.U_QuoModle,
        /*采购报价型号*/
        fp.U_QuoQty,
        /*采购报价数量*/
        fp.U_CardName,
        /*供应商名称*/
        fp.U_QuoPrice,
        /*供方报价*/
        fp.U_QuoYear,
        /*供方批次*/
        fp.U_QuoRemark,
        /*供方备注*/
        fp.U_Remark1,
        /*采购备注*/
        fp.StanPackage,
        /*标准包装*/
        fp.MinQty,
        /*起订量*/
        fp.ContPerson,
        /*联系人*/
        fp.ContEmail,
        /*邮箱*/
        fp.ContPhone,
        /*电话*/
        fp.ContAddress,
        /*地址*/
        fp.U_QuoLevel, /*供方评级*/
        fp.U_QuoVatGroup,
        fp.U_QuoCurr,
        T_OVTG.Rate AS 'U_QuoVatRate'
        FROM
        U_ICIN1 U_ICIN1
        LEFT JOIN (
        SELECT
        BC.*
        FROM
        ( SELECT DocEntry, U_BaseLine, MAX ( LineNum ) AS LineNum FROM T_ICIN1 GROUP BY U_BaseLine, DocEntry ) AC
        LEFT JOIN T_ICIN1 BC ON AC.DocEntry = BC.DocEntry
        AND AC.LineNum = BC.LineNum
        WHERE
        U_Buyer = #{UserSign}
        ) fp ON U_ICIN1.DocEntry = fp.DocEntry AND U_ICIN1.LineNum = fp.U_BaseLine
        LEFT JOIN T_ICIN ON T_ICIN.DocEntry = U_ICIN1.DocEntry
        LEFT JOIN T_OVTG ON fp.U_QuoVatGroup = T_OVTG.Code
        <where>
            ${ew.getSqlSegment()}
            AND ',' + U_ICIN1.Buyers + ',' LIKE CONCAT('%,', #{UserSign} ,',%')
        </where>
        ORDER BY U_ICIN1.DocEntry DESC,
        U_ICIN1.LineNum ASC
    </select>
    <select id="selectOne" resultType="com.lianchuangjie.lianchuangjie.entity.QuotationEntity">
        SELECT * FROM T_ICIN1
        <where>
            ${ew.getSqlSegment()}
        </where>
    </select>
</mapper>
