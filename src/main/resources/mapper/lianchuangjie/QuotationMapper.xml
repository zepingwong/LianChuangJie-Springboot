<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lianchuangjie.lianchuangjie.mapper.QuotationMapper">
    <select id="selectList" resultType="com.lianchuangjie.lianchuangjie.vo.QuotationVO">
        SELECT
        U_ICIN1.*,
        U_ICIN1.PrePrice AS 'U_PrePrice',
        fp.U_BaseLine,
        fp.U_BaseEntry,
        fp.U_Status,
        T_ICIN.InquiryDate,
        T_ICIN.U_DomainName,
        T_ICIN.U_CusLevel,
        T_ICIN.U_CusGroupCode,
        T_ICIN.U_DeptName,
        T_ICIN.U_UserName
        FROM
        U_ICIN1 U_ICIN1
        LEFT JOIN (
        SELECT
        BC.*
        FROM
        ( SELECT DocEntry, MAX ( LineNum ) AS LineNum FROM T_ICIN1 GROUP BY DocEntry ) AC
        LEFT JOIN T_ICIN1 BC ON AC.DocEntry = BC.DocEntry AND AC.LineNum = BC.LineNum
        WHERE U_Buyer = #{UserSign}
        ) fp ON U_ICIN1.DocEntry = fp.DocEntry
        LEFT JOIN T_ICIN ON T_ICIN.DocEntry = U_ICIN1.DocEntry
        <where>
            ${ew.getSqlSegment()}
            AND ',' + U_ICIN1.Buyers + ',' LIKE CONCAT('%,', #{UserSign} ,',%')
        </where>

    </select>
</mapper>
