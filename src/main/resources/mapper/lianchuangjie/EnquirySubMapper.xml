<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lianchuangjie.lianchuangjie.mapper.EnquirySubMapper">

    <select id="selectList" resultType="com.lianchuangjie.lianchuangjie.vo.EnquirySubVO">
        SELECT U_ICIN1.*
        FROM U_ICIN1
        LEFT JOIN T_ICIN ON T_ICIN.DocEntry = U_ICIN1.DocEntry
        LEFT JOIN T_ICIN1 ON U_ICIN1.BaseEntry = T_ICIN1.DocEntry AND U_ICIN1.BaseLine = T_ICIN1.LineNum
        <where>
            ${ew.getSqlSegment()}
        </where>
    </select>
    <select id="selectQuotationTabList" resultType="com.lianchuangjie.lianchuangjie.vo.TabQuotationNeedsVO">
        SELECT
        U_ICIN1.Secrecy, /*是否保密*/
        U_ICIN1.Modle, /*需求型号*/
        U_ICIN1.Brand, /*需求品牌*/
        U_ICIN1.DemandQty, /*需求数量*/
        U_ICIN1.ECCN, /*ECCN*/
        U_ICIN1.Currency, /*货币*/
        T_ICIN.InquiryDate, /*询价日期*/
        T_ICIN.U_UserName, /*销售员姓名*/
        T_ICIN.U_DeptName, /*销售部门*/
        T_ICIN.U_CusGroupCode, /*客户性质名称*/
        T_ICIN.U_CusLevel, /*客户等级名称*/
        T_ICIN.U_DomainName, /*客户行业名称*/
        T_ICIN.U_DocCur, /*报价货币*/
        T_ICIN.U_VatGroup, /*报价税率*/
        T_OVTG.Name AS 'U_VatName', /*税率文本*/
        T_OVTG.Rate AS 'U_VatRate' /*税点*/
        FROM
        U_ICIN1
        LEFT JOIN T_ICIN ON T_ICIN.DocEntry = U_ICIN1.DocEntry
        LEFT JOIN T_OVTG ON T_ICIN.U_VatGroup = T_OVTG.Code
        WHERE
        U_ICIN1.Modle IN (
        SELECT
        SDADA_1.sno
        FROM
        SDADA SDADA_1
        WHERE
        SDADA_1.TAG IN
        (
        SELECT SDADA.TAG FROM SDADA WHERE SDADA.sno IN
        <foreach collection="sc.modleList " item="item" open="(" separator="," close=")" index="index">
            '${item}'
        </foreach>
        )
        )
        AND U_ICIN1.Secrecy != 'Y' /*非保密*/
    </select>
    <select id="selectEnquiryTabList" resultType="com.lianchuangjie.lianchuangjie.vo.TabEnquiryNeedsVO">
        SELECT
        U_ICIN1.Secrecy, /*是否保密*/
        U_ICIN1.Modle, /*需求型号*/
        U_ICIN1.Brand, /*需求品牌*/
        U_ICIN1.DemandQty, /*需求数量*/
        U_ICIN1.ECCN, /*ECCN*/
        IIF((T_ICIN.UserSign != ${sc.getUserSign}), '******', T_ICIN.CardName) AS
        'CardName', /*只能看到自己权限内的客户名称*/
        U_ICIN1.Currency, /*货币*/
        T_ICIN.InquiryDate, /*询价日期*/
        T_ICIN.U_UserName, /*销售员姓名*/
        T_ICIN.U_DeptName, /*销售部门*/
        T_ICIN.U_CusGroupCode, /*客户性质名称*/
        T_ICIN.U_CusLevel, /*客户等级名称*/
        T_ICIN.U_DomainName, /*客户行业名称*/
        T_ICIN.U_DocCur, /*报价货币*/
        T_OVTG.Name AS 'U_VatName', /*税率文本*/
        U_ICIN1.PriceAfVAT, /*销售报价*/
        U_ICIN1.Delivery, /*报价货期*/
        U_ICIN1.LineRemark /*销售备注*/
        FROM
        U_ICIN1
        LEFT JOIN T_ICIN ON T_ICIN.DocEntry = U_ICIN1.DocEntry
        LEFT JOIN T_OVTG ON T_ICIN.U_VatGroup = T_OVTG.Code
        WHERE
        U_ICIN1.Modle IN (
        SELECT
        SDADA_1.sno
        FROM
        SDADA SDADA_1
        WHERE
        SDADA_1.TAG IN
        (
        SELECT SDADA.TAG FROM SDADA WHERE SDADA.sno IN
        <foreach collection="sc.modleList " item="item" open="(" separator="," close=")" index="index">
            '${item}'
        </foreach>
        )
        )
        AND ((T_ICIN.UserSign = ${sc.getUserSign} AND U_ICIN1.Secrecy = 'Y') /*自己负责的保密内容*/
        OR U_ICIN1.Secrecy = 'N' /*非保密内容*/
        )

    </select>
</mapper>
